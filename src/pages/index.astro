---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Button from '../components/Button.astro';
import Hero from '../components/Hero.astro';
import PostPreview from '../components/PostPreview.astro';
import siteConfig from '../data/site-config';
import { sortItemsByDateDesc } from '../utils/data-utils';

const posts = (await getCollection('blog')).sort(sortItemsByDateDesc);
const featuredPosts = posts.filter(({ data }) => data.isFeatured);

const projects = [
    { name: "Openbox Deal Finder", year: "Jan 2026", desc: "Daily open-box deal finder web app", status: "In Progress", url: "https://github.com/iamhenry/openbox-deal-finder" },
    { name: "OpenCode Antigravity Quota", year: "Jan 2026", desc: "OpenCode tmux session manager", status: "Active", url: "https://github.com/iamhenry/opencode-antigravity-quota-tmux" },
    { name: "VS Code Vercel Theme", year: "Dec 2025", desc: "Vercel-inspired VS Code theme", status: "Active", url: "https://github.com/iamhenry/vscode-vercel-theme" },
    { name: "Playport", year: "Oct 2025", desc: "Move music from Apple Music to Spotify seamlessly", status: "Active", url: "https://useplayport.com" },
    { name: "CatCode", year: "Aug 2025", desc: "Code editor tool", status: "Active", url: "https://github.com/iamhenry/catcode" },
];
---

<BaseLayout description={siteConfig.description} image={siteConfig.image}>
    <Hero />
    <div class="mb-16 sm:mb-24">
        <h2 class="mb-12 text-xl font-serif italic sm:mb-16 sm:text-2xl">Projects</h2>
        <div class="flex flex-col text-sm">
            <!-- Header Row -->
            <div class="flex border-b border-main opacity-70">
                <div class="flex-[2] py-4 pr-4 font-medium">Project</div>
                <div class="flex-1 py-4 pr-4 font-medium">Started</div>
                <div class="flex-[3] py-4 pr-4 font-medium">Description</div>
                <div class="flex-1 py-4 font-medium">Status</div>
            </div>
            <!-- Data Rows -->
            {projects.map((project) => (
                <div class="flex border-b border-main/30">
                    <div class="flex-[2] py-5 pr-4">
                        <a 
                            href={project.url} 
                            target="_blank" 
                            rel="noopener noreferrer"
                            class="underline underline-offset-2 hover:opacity-70 transition-opacity"
                        >
                            {project.name}
                        </a>
                    </div>
                    <div class="flex-1 py-5 pr-4 opacity-70">{project.year}</div>
                    <div class="flex-[3] py-5 pr-4">{project.desc}</div>
                    <div class="flex-1 py-5 opacity-70">{project.status}</div>
                </div>
            ))}
        </div>
        <div class="mt-12 sm:mt-16">
            <Button href="/projects">View All Projects</Button>
        </div>
    </div>
    {
        featuredPosts?.length > 0 && (
            <div class="mb-16 sm:mb-24">
                <h2 class="mb-12 text-xl font-serif italic sm:mb-16 sm:text-2xl">Writing</h2>
                {featuredPosts.map((post) => (
                    <PostPreview post={post} class="mb-10 sm:mb-12" headingLevel="h3" />
                ))}
                <div class="mt-12 sm:mt-16">
                    <Button href="/blog">View All Posts</Button>
                </div>
            </div>
        )
    }
</BaseLayout>
